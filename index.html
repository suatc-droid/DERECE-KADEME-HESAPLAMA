<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nihai Memuriyet Hesaplama</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            opacity: 0.8;
        }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white rounded-xl shadow-lg p-6 md:p-8">
        
        <div class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Nihai Memuriyet Hesaplama</h1>
            <p class="text-gray-500 mt-2">Derece ve kademenizi tÃ¼m detaylarÄ±yla hesaplayÄ±n.</p>
        </div>

        <!-- Form AlanÄ± -->
        <form id="hesaplamaFormu" class="space-y-6">
            
            <!-- Temel Bilgiler BÃ¶lÃ¼mÃ¼ -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 border-b pb-2 mb-4">Temel Bilgiler</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="egitim" class="block text-sm font-medium text-gray-700 mb-1">EÄŸitim Durumu / Unvan</label>
                        <select id="egitim" onchange="toggleDinamikAlanlar()" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                            <option value="saglik_onlisans">ðŸ’ŠSAÄžLIK Ã–NLÄ°SANS (2 YÄ±llÄ±k)</option>
                            <option value="saglik_lisans">ðŸ’ŠSAÄžLIK LÄ°SANS (4 YÄ±llÄ±k)</option>
                            <option value="dis_tabibi">ðŸ’ŠDÄ°Åž TABÄ°BÄ°</option>
                            <option value="tabip">ðŸ’ŠTABÄ°P</option>
                            <option value="uzman_tabip">ðŸ’ŠUZMAN TABÄ°P</option>
                            <option value="ilk">Ä°lkokul</option>
                            <option value="orta">Ortaokul</option>
                            <option value="lise" selected>Lise ve Dengi</option>
                            <option value="onlisans">Ã–nlisans (2 YÄ±llÄ±k)</option>
                            <option value="lisans">Lisans (4 YÄ±llÄ±k)</option>
                            <option value="yukseklisans">YÃ¼ksek Lisans (DoÄŸrudan)</option>
                            <option value="doktora">Doktora</option>
                        </select>
                    </div>
                    <div>
                        <label for="baslamaTarihi" class="block text-sm font-medium text-gray-700 mb-1">Ä°lk GÃ¶reve BaÅŸlama Tarihi</label>
                        <input type="date" id="baslamaTarihi" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                    </div>
                </div>
                
                <!-- YÃ¼ksek Lisans (Lisans seÃ§ilirse gÃ¶rÃ¼nÃ¼r) -->
                <div id="yuksekLisansAlani" class="hidden mt-4 pl-1">
                    <div class="flex items-start">
                        <input id="yuksekLisansVarMi" type="checkbox" class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 mt-0.5">
                        <label for="yuksekLisansVarMi" class="ml-3 block text-sm font-medium text-gray-700">YÃ¼ksek lisansÄ±nÄ±z var mÄ±? (+1 Kademe)</label>
                    </div>
                </div>

                <!-- Ä°stifa Bilgileri (Tabip veya Uzman Tabip seÃ§ilirse gÃ¶rÃ¼nÃ¼r) -->
                <div id="tabipIstifaAlani" class="hidden mt-4 space-y-4">
                    <hr>
                    <h4 class="text-md font-semibold text-gray-800">Ä°stifa Bilgileri</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="istifaTarihi" class="block text-sm font-medium text-gray-700 mb-1">Ä°stifa Tarihi</label>
                            <input type="date" id="istifaTarihi" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div>
                            <label for="tekrarBaslamaTarihi" class="block text-sm font-medium text-gray-700 mb-1">Tekrar GÃ¶reve BaÅŸlama T.</label>
                            <input type="date" id="tekrarBaslamaTarihi" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1 pl-1">Ä°ki tarih arasÄ±ndaki sÃ¼re hizmet sÃ¼renizden dÃ¼ÅŸÃ¼lecektir.</p>
                </div>
            </div>

            <!-- Ä°stisnai Durumlar ve Hizmet DetaylarÄ± BÃ¶lÃ¼mÃ¼ -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 border-b pb-2 mb-4">Ä°stisnai Durumlar ve Hizmet DetaylarÄ±</h3>
                <div class="space-y-4">
                    
                    <!-- Kadroya GeÃ§iÅŸ -->
                    <div class="flex items-start">
                        <input id="kadroyaGecisVarMi" type="checkbox" onchange="toggleKadroTarihi()" class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 mt-0.5">
                        <label for="kadroyaGecisVarMi" class="ml-3 block text-sm font-medium text-gray-700">SÃ¶zleÅŸmeli statÃ¼den kadroya geÃ§tim.</label>
                    </div>
                    <div id="kadroTarihiAlani" class="hidden pl-8">
                        <label for="kadroyaGecisTarihi" class="block text-sm font-medium text-gray-700 mb-1">Kadroya GeÃ§iÅŸ Tarihi</label>
                        <input type="date" id="kadroyaGecisTarihi" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                    </div>
                    
                    <hr class="my-2">
                    
                    <!-- Ãœcretsiz Ä°zin -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ãœcretsiz Ä°zin SÃ¼resi (Toplam)</label>
                        <div class="grid grid-cols-3 gap-2">
                            <input type="number" id="izinYil" placeholder="YÄ±l" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-center">
                            <input type="number" id="izinAy" placeholder="Ay" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-center">
                            <input type="number" id="izinGun" placeholder="GÃ¼n" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition text-center">
                        </div>
                        <p class="text-xs text-gray-500 mt-1 pl-1">Bu sÃ¼re, hizmet sÃ¼renizden dÃ¼ÅŸÃ¼lecektir.</p>
                    </div>

                    <hr class="my-2">
                    
                    <!-- Hizmet BÃ¶lgesi -->
                    <div>
                        <label for="hizmetBolgesi" class="block text-sm font-medium text-gray-700 mb-1">GÃ¶rev YapÄ±lan Hizmet BÃ¶lgesi</label>
                        <select id="hizmetBolgesi" onchange="toggleBolgeTarihAlani()" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                            <option value="0">SeÃ§iniz...</option>
                            <option value="1">1. BÃ¶lge</option>
                            <option value="2">2. BÃ¶lge</option>
                            <option value="3">3. BÃ¶lge</option>
                            <option value="4">4. BÃ¶lge</option>
                            <option value="5">5. BÃ¶lge</option>
                            <option value="6">6. BÃ¶lge</option>
                        </select>
                    </div>
                    <!-- 6. BÃ¶lge Tarih AlanÄ± (Gizli) -->
                    <div id="bolgeTarihAlani" class="hidden pl-2 space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div>
                                <label for="bolgeGorevBaslamaTarihi" class="block text-sm font-medium text-gray-700 mb-1">BÃ¶lgedeki GÃ¶reve BaÅŸlama T.</label>
                                <input type="date" id="bolgeGorevBaslamaTarihi" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                             </div>
                             <div>
                                <label for="bolgeGorevBitisTarihi" class="block text-sm font-medium text-gray-700 mb-1">BÃ¶lgedeki GÃ¶rev BitiÅŸ T. (Varsa)</label>
                                <input type="date" id="bolgeGorevBitisTarihi" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                             </div>
                        </div>
                         <p class="text-xs text-gray-500 mt-1 pl-1">Ek kademe, 6. bÃ¶lgede geÃ§en her 2 kadrolu hizmet yÄ±lÄ± iÃ§in verilir. Hala Ã§alÄ±ÅŸÄ±yorsanÄ±z BitiÅŸ Tarihini boÅŸ bÄ±rakÄ±n.</p>
                    </div>

                    <hr class="my-2">
                    
                    <!-- Disiplin CezasÄ± -->
                    <div class="flex items-start">
                        <input id="cezaYok" type="checkbox" class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 mt-0.5">
                        <label for="cezaYok" class="ml-3 block text-sm font-medium text-gray-700">Son 8 yÄ±l iÃ§inde disiplin cezasÄ± almadÄ±m. (+1 Kademe)</label>
                    </div>

                </div>
            </div>

            <!-- Hesapla Butonu -->
            <button type="button" onclick="hesapla()" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105 shadow-md">
                Hesapla
            </button>
        </form>

        <!-- SonuÃ§ AlanÄ± -->
        <div id="sonucAlani" class="hidden mt-6 p-4 border-l-4 rounded-r-lg"></div>
        
    </div>

    <!-- JavaScript KodlarÄ± -->
    <script>
        
        // EÄŸitim durumuna gÃ¶re Y. Lisans ve Ä°stifa alanlarÄ±nÄ± gÃ¶ster/gizle
        function toggleDinamikAlanlar() {
            const egitim = document.getElementById('egitim').value;
            
            // YÃ¼ksek Lisans AlanÄ±
            const yuksekLisansAlani = document.getElementById('yuksekLisansAlani');
            const isLisans = egitim === 'lisans' || egitim === 'saglik_lisans';
            yuksekLisansAlani.classList.toggle('hidden', !isLisans);
            if (!isLisans) document.getElementById('yuksekLisansVarMi').checked = false;

            // Tabip Ä°stifa AlanÄ± (Uzman Tabip iÃ§in de geÃ§erli)
            const tabipIstifaAlani = document.getElementById('tabipIstifaAlani');
            const isTabip = egitim === 'tabip' || egitim === 'uzman_tabip';
            tabipIstifaAlani.classList.toggle('hidden', !isTabip);
            if (!isTabip) {
                document.getElementById('istifaTarihi').value = '';
                document.getElementById('tekrarBaslamaTarihi').value = '';
            }
        }

        // Kadroya geÃ§iÅŸ tarihi alanÄ±nÄ± gÃ¶ster/gizle
        function toggleKadroTarihi() {
            document.getElementById('kadroTarihiAlani').classList.toggle('hidden', !document.getElementById('kadroyaGecisVarMi').checked);
        }

        // 6. BÃ¶lge tarih alanlarÄ±nÄ± gÃ¶ster/gizle
        function toggleBolgeTarihAlani() {
            const hizmetBolgesi = document.getElementById('hizmetBolgesi').value;
            const bolgeTarihAlani = document.getElementById('bolgeTarihAlani');
            const isAltinciBolge = hizmetBolgesi === '6';
            bolgeTarihAlani.classList.toggle('hidden', !isAltinciBolge);
            if(!isAltinciBolge) {
                document.getElementById('bolgeGorevBaslamaTarihi').value = '';
                document.getElementById('bolgeGorevBitisTarihi').value = '';
            }
        }

        /**
         * Ä°ki tarih arasÄ±ndaki farkÄ± yÄ±l, ay ve gÃ¼n olarak hesaplar.
         * @param {Date} start BaÅŸlangÄ±Ã§ tarihi
         * @param {Date} end BitiÅŸ tarihi
         * @returns {object} { years: number, months: number, days: number }
         */
        function calculateDateDifference(start, end) {
            if (start > end) return { years: 0, months: 0, days: 0 };
            
            let years = end.getFullYear() - start.getFullYear();
            let months = end.getMonth() - start.getMonth();
            let days = end.getDate() - start.getDate();

            if (days < 0) {
                months--;
                days += new Date(end.getFullYear(), end.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }
            return { years, months, days };
        }

        // Ana Hesaplama Fonksiyonu
        function hesapla() {
            const sonucAlani = document.getElementById('sonucAlani');
            sonucAlani.innerHTML = '';
            sonucAlani.classList.add('hidden');

            function showError(message) {
                sonucAlani.innerHTML = `<p class="text-md">${message}</p>`;
                sonucAlani.className = 'mt-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg text-red-700';
                sonucAlani.classList.remove('hidden');
            }

            // 1. GÄ°RDÄ°LERÄ° AL VE DOÄžRULA
            const baslamaTarihiString = document.getElementById('baslamaTarihi').value;
            if (!baslamaTarihiString) return showError('LÃ¼tfen geÃ§erli bir ilk gÃ¶reve baÅŸlama tarihi seÃ§in.');

            const baslamaTarihi = new Date(baslamaTarihiString);
            const bugun = new Date();
            if (baslamaTarihi > bugun) return showError('Ä°lk baÅŸlama tarihi gelecek bir tarih olamaz.');
            
            // 2. BRÃœT HÄ°ZMET SÃœRESÄ°NÄ° HESAPLA
            const brutHizmet = calculateDateDifference(baslamaTarihi, bugun);
            
            // 3. KESÄ°NTÄ°LERÄ° HESAPLA
            const izinYil = parseInt(document.getElementById('izinYil').value) || 0;
            const izinAy = parseInt(document.getElementById('izinAy').value) || 0;
            const izinGun = parseInt(document.getElementById('izinGun').value) || 0;

            const istifaTarihiString = document.getElementById('istifaTarihi').value;
            const tekrarBaslamaTarihiString = document.getElementById('tekrarBaslamaTarihi').value;
            let istifaSuresi = { years: 0, months: 0, days: 0 };

            if (istifaTarihiString && tekrarBaslamaTarihiString) {
                const istifaTarihi = new Date(istifaTarihiString);
                const tekrarBaslamaTarihi = new Date(tekrarBaslamaTarihiString);

                if (istifaTarihi > tekrarBaslamaTarihi) return showError('Tekrar baÅŸlama tarihi, istifa tarihinden Ã¶nce olamaz.');
                if (istifaTarihi < baslamaTarihi) return showError('Ä°stifa tarihi, ilk baÅŸlama tarihinden Ã¶nce olamaz.');
                
                istifaSuresi = calculateDateDifference(istifaTarihi, tekrarBaslamaTarihi);
            } else if (istifaTarihiString || tekrarBaslamaTarihiString) {
                return showError('LÃ¼tfen hem istifa hem de tekrar baÅŸlama tarihini girin (veya ikisini de boÅŸ bÄ±rakÄ±n).');
            }

            const toplamKesintiYil = izinYil + istifaSuresi.years;
            const toplamKesintiAy = izinAy + istifaSuresi.months;
            const toplamKesintiGun = izinGun + istifaSuresi.days;

            // 4. NET HÄ°ZMET SÃœRESÄ°NÄ° HESAPLA
            let netGun = brutHizmet.days - toplamKesintiGun;
            let netAy = brutHizmet.months - toplamKesintiAy;
            let netYil = brutHizmet.years - toplamKesintiYil;

            if (netGun < 0) { netAy--; netGun += 30; }
            if (netAy < 0) { netYil--; netAy += 12; }
            
            const netHizmetSuresi = { years: Math.max(0, netYil), months: Math.max(0, netAy), days: Math.max(0, netGun) };
            const hizmetYili = netHizmetSuresi.years;
            
            // 5. BAÅžLANGIÃ‡ VE BONUSLARI AYARLA
            const egitim = document.getElementById('egitim').value;
            const cezaYok = document.getElementById('cezaYok').checked;
            const yuksekLisansVarMi = document.getElementById('yuksekLisansVarMi').checked;
            const kadroyaGecisVarMi = document.getElementById('kadroyaGecisVarMi').checked;
            const kadroyaGecisTarihiString = document.getElementById('kadroyaGecisTarihi').value;
            
            let kadroluBaslamaTarihi = baslamaTarihi;
            if (kadroyaGecisVarMi) {
                if (!kadroyaGecisTarihiString) return showError('Kadroya geÃ§iÅŸ tarihi girilmelidir.');
                kadroluBaslamaTarihi = new Date(kadroyaGecisTarihiString);
                if (kadroluBaslamaTarihi < baslamaTarihi) return showError('Kadroya geÃ§iÅŸ tarihi, ilk baÅŸlama tarihinden Ã¶nce olamaz.');
            }
            
            // GÃœNCELLENDÄ°: 15.01.2016 tarihi ve Ã¶ncesi (<=) kontrolÃ¼
            const is2016Oncesi = baslamaTarihi <= new Date('2016-01-15');
            let baslangicDerece = 0, baslangicKademe = 0;

            switch (egitim) {
                case 'ilk': baslangicDerece = 15; baslangicKademe = 1; break;
                case 'orta': baslangicDerece = 14; baslangicKademe = 2; break;
                case 'lise': baslangicDerece = 13; baslangicKademe = 3; break;
                case 'onlisans': baslangicDerece = 10; baslangicKademe = 2; break;
                case 'saglik_onlisans': baslangicDerece = 10; baslangicKademe = 2; break;
                case 'lisans': baslangicDerece = 9; baslangicKademe = 1; break;
                case 'saglik_lisans': baslangicDerece = 8; baslangicKademe = 1; break;
                case 'dis_tabibi': baslangicDerece = 8; baslangicKademe = 2; break;
                case 'tabip': baslangicDerece = 8; baslangicKademe = 3; break;
                case 'uzman_tabip': baslangicDerece = 8; baslangicKademe = 3; break;
                case 'yukseklisans': baslangicDerece = 9; baslangicKademe = 2; break;
                case 'doktora': baslangicDerece = 9; baslangicKademe = 1; break;
            }

            let bonusKademeler = 0;
            if (cezaYok) bonusKademeler++;
            // if (is2016Oncesi) bonusKademeler++; // GÃœNCELLENDÄ°: Buradan kaldÄ±rÄ±ldÄ±
            if (yuksekLisansVarMi) bonusKademeler++;

            // 6. BÃ¶lge Hizmeti Bonusu
            const hizmetBolgesi = document.getElementById('hizmetBolgesi').value;
            const bolgeGorevBaslamaTarihiString = document.getElementById('bolgeGorevBaslamaTarihi').value;
            const bolgeGorevBitisTarihiString = document.getElementById('bolgeGorevBitisTarihi').value;

            if (hizmetBolgesi === '6' && bolgeGorevBaslamaTarihiString) {
                const bolgeBaslama = new Date(bolgeGorevBaslamaTarihiString);
                let hesaplamaBitisTarihi = bugun; 

                if (bolgeGorevBitisTarihiString) {
                    hesaplamaBitisTarihi = new Date(bolgeGorevBitisTarihiString);
                    if (hesaplamaBitisTarihi < bolgeBaslama) return showError('BÃ¶lge gÃ¶rev bitiÅŸ tarihi, baÅŸlangÄ±Ã§ tarihinden Ã¶nce olamaz.');
                }
                
                const efektifBolgeBaslamaTarihi = new Date(Math.max(kadroluBaslamaTarihi, bolgeBaslama));
                
                if (efektifBolgeBaslamaTarihi < hesaplamaBitisTarihi) {
                    const bolgedekiHizmet = calculateDateDifference(efektifBolgeBaslamaTarihi, hesaplamaBitisTarihi);
                    bonusKademeler += Math.floor(bolgedekiHizmet.years / 2);
                }
            }

            // 6. FÄ°NAL HESAPLAMA
            let toplamKademe = baslangicKademe + hizmetYili + bonusKademeler;
            let mevcutDerece = baslangicDerece - Math.floor((toplamKademe - 1) / 3);
            let mevcutKademe = ((toplamKademe - 1) % 3) + 1;
            
            // Ã–zel derece ilerlemeleri
            if (egitim === 'doktora') mevcutDerece--; 
            if (egitim === 'uzman_tabip') mevcutDerece--; 
            if (is2016Oncesi) mevcutDerece--; // GÃœNCELLENDÄ°: +1 Derece buraya eklendi
            
            if (mevcutDerece < 1) mevcutDerece = 1; // En dÃ¼ÅŸÃ¼k derece 1 olabilir

            // 7. SONUCU GÃ–STER
            const sonucBaslik = `<h3 class="text-lg font-bold text-green-800 mb-2">Hesaplama SonuÃ§larÄ±</h3>`;
            const hizmetSuresiMetni = `<p class="text-md text-green-700"><strong>Dereceye Esas Hizmet SÃ¼reniz:</strong> ${netHizmetSuresi.years} yÄ±l, ${netHizmetSuresi.months} ay, ${netHizmetSuresi.days} gÃ¼n</p>`;
            const dereceSonucMetni = `<p class="mt-1 text-md text-green-700"><strong>Mevcut Derece/Kademeniz:</strong> ${mevcutDerece} / ${mevcutKademe}</p>`;
            
            sonucAlani.className = 'mt-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-r-lg';
            sonucAlani.innerHTML = sonucBaslik + hizmetSuresiMetni + dereceSonucMetni;
            sonucAlani.classList.remove('hidden');
        }
    </script>

</body>
</html>




